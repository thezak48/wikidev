# 故障排除

## 请求帮助

需要帮助吗？没关系，每个人有时都需要帮助。您可以通过以下方式获得实时帮助：

- [<i class="fab fa-discord"></i>&emsp;Discord *官方 Lidarr Discord*](https://lidarr.audio/discord)
- [<i class="fab fa-reddit"></i>&emsp;Reddit *官方 Lidarr Subreddit*](https://reddit.com/r/lidarr)
{.links-list}

但在您去那里发帖之前，请确保您的求助请求尽可能清晰明了。清楚地描述问题，并简要描述您的设置，包括操作系统/发行版、.NET 版本、Lidarr 版本、下载客户端及其版本等。**如果您使用 [Docker](https://www.docker.com/)，请先阅读 [Docker 指南](/docker-guide)，因为它可以解决常见且频繁的路径/权限问题。否则，请准备好 [docker compose](/docker-guide#docker-compose)。[如何生成 Docker Compose](https://trash-guides.info/compose)** 告诉我们您已经尝试过什么，查看了什么。使用 [日志和日志文件](#logging-and-log-files) 部分将日志级别提升到 trace，重现问题，将相关上下文粘贴到 pastebin，并在帖子中包含链接。甚至可以包含一些屏幕截图以突出显示问题。

我们了解得越多，就越容易帮助您。

## 日志和日志文件

还可以查看常见故障排除问题：
- [下载和导入常见问题](#downloads-and-importing)
- [搜索索引器和跟踪器常见问题](#searches-indexers-and-trackers)
{.links-list}

如果要求提供调试日志，则您的日志将包含 `debug`，如果要求提供跟踪日志，则您的日志将包含 `trace`。如果您提供的日志不包含其中任何一个，则不是所请求的日志。

- 除非被要求，否则不要共享整个日志文件。
- 除非被要求，否则不要直接上传日志到 Discord 或将其粘贴为文本墙。
- 请勿将日志作为附件、zip 压缩文件或任何其他形式的文件共享。

为了提供好的和有用的共享日志：

> 确保没有运行类似于 RSS 刷新的垃圾任务
{.is-warning}

1. [将日志级别提升到 trace（设置 => 通用 => 日志级别或编辑配置文件）](#tracedebug-logs)
2. [清除日志（系统 => 日志 => 清除日志或删除日志文件夹中的所有日志）](#clearing-logs)
3. 重现问题（重新执行导致问题的操作）
4. [通过 UI 或日志文件（Lidarr.trace.txt）](#standard-logs-location) 在文件系统上找到相关上下文
5. 复制问题之前的大块内容、问题本身和问题之后的大块内容。
6. 使用 [Gist](https://gist.github.com/)、[0bin（**确保禁用着色**）](https://0bin.net/)、[PrivateBin](https://privatebin.net/)、[Notifiarr PrivateBin](http://logs.notifiarr.com/)、[Hastebin](https://hastebin.com/)、[Ubuntu 的 Pastebin](https://pastebin.ubuntu.com/) 或类似的网站（请避免下面列出的网站）共享上述复制的日志

**警告：**
- **请勿使用 [pastebin.com](https://pastebin.com)，因为它们的过滤器往往会阻止日志。**
- **请勿使用 [pastebin.pl](https://pastebin.pl)，因为该网站经常无法访问。**
- **请勿使用 [JustPasteIt](https://justpaste.it/)，因为该网站无法方便地查看日志。**
- **请勿上传日志文件。**
- **请勿通过 Google Drive、Dropbox 或任何其他未在上述列出的网站上共享您的日志。**
- **请勿存档（zip、tar（tarball）、7zip 等）您的日志。**
- **请勿共享控制台输出、Docker 容器输出或除应用程序日志之外的任何内容。**

**重要提示：**
- 使用 [0bin](https://0bin.net/) 时，请确保禁用着色，并且阅后即焚。

- 或者，如果您正在查找旧日志文件中的特定条目，但不确定哪个文件，可以使用 Notepad++。您可以使用 Notepad++ 的“在文件中查找”功能根据需要搜索旧日志文件。
- **仅适用于 Unix：** 或者，如果您正在查找旧日志文件中的特定条目，但不确定哪个文件，可以使用 grep。例如，如果您想查找有关电影/节目/书籍/歌曲/索引器“Shooter”的信息，可以运行以下命令：`grep -inr -C 100 -e 'Shooter' /path/to/logs/*.trace*.txt` 如果您的 [Appdata 目录](/lidarr/appdata-directory) 在主文件夹中，则运行：`grep -inr -C 100 -e 'Shooter' /home/$User/.config/logs/*.trace*.txt`

```none

    * 这些标志具有以下功能
    * -i：忽略大小写
    * -n：显示行号
    * -r：递归检查路径中的所有文件
    * -C：提供找到的行之前和之后的行数
    * -e：要搜索的模式

```

## 标准日志位置

日志文件位于 Lidarr 的 [Appdata 目录](/lidarr/appdata-directory)内的 logs/ 文件夹中。您还可以通过 UI 在 System => Logs => Files 中访问日志文件。

> 注意：UI 中的日志（"Events"）表与日志文件不同，并且不太有用。如果要求提供日志，请从日志文件而不是表中复制/粘贴。
{.is-info}

## 更新日志位置

更新日志文件位于 Lidarr 的 [Appdata 目录](/lidarr/appdata-directory)内的 UpdateLogs/ 文件夹中。

## 共享日志

日志可能很长，很难在论坛或 Reddit 帖子中阅读，并且在 Discord 中会产生垃圾信息，因此请使用 [Pastebin](https://pastebin.ubuntu.com/)、[Hastebin](https://hastebin.com/)、[Gist](https://gist.github.com)、[0bin](https://0bin.net) 或任何其他类似的 pastebin 网站。通常不需要整个文件，只需要问题/错误之前和之后的一些上下文即可。不要忘记等待垃圾任务（如 RSS 同步或库刷新）完成。

## 跟踪/调试日志

您可以在设置 => 通用 => 日志记录 中更改日志级别。Lidarr 不需要重新启动即可生效。此更改仅影响日志文件，而不影响日志数据库。最新的调试/跟踪日志文件分别命名为 `lidarr.debug.txt` 和 `lidarr.trace.txt`。

如果无法访问 UI 来设置日志级别，可以通过编辑 AppData 目录中的 config.xml 文件来进行设置。将 LogLevel 的值设置为 Debug 或 Trace，而不是 Info。

```xml
 <Config>
  [...]
  <LogLevel>debug</LogLevel>
  [...]
 </Config>
```

## 清除日志

您可以直接从 UI 中清除日志文件和日志数据库，方法是在 System => Logs => Files 和 System => Logs => Delete（垃圾桶图标）下进行操作。

# 多个日志文件

Lidarr 使用每个限制为 1MB 的滚动日志文件。当前日志文件始终是 `lidarr.txt`，其他文件的名称为 `.0.txt`（数字越大，文件越旧）。此日志文件包含 `fatal`、`error`、`warn` 和 `info` 条目。

启用调试日志级别时，还会出现额外的 `lidarr.debug.txt` 滚动日志文件。此日志文件包含 `fatal`、`error`、`warn`、`info` 和 `debug` 条目。它通常覆盖了 40 小时的时间段。

启用跟踪日志级别时，还会出现额外的 `lidarr.trace.txt` 滚动日志文件。此日志文件包含 `fatal`、`error`、`warn`、`info`、`debug` 和 `trace` 条目。由于跟踪详细程度较高，它通常只覆盖几个小时。

# 从更新失败中恢复

我们尽一切努力防止升级时出现问题，但如果确实出现问题，本文将指导您恢复安装。

## 确定问题

- 在更新后应用程序无法启动时，最好的方法是查看[更新日志](#update-logs-location)，并查看更新是否成功完成。如果没有问题，那么下一步是查看常规应用程序日志文件，在尝试重新启动之前，使用[日志记录](/lidarr/settings#logging)和[日志文件](/lidarr/system#log-files)找到它们并增加日志级别。
- 最常见的问题是应用程序所安装的系统在升级期间操纵了 `/tmp` 目录，并在升级期间删除了关键的 \*Arr 文件，从而导致升级和回滚都失败。在这种情况下，只需在现有的损坏安装上重新安装即可。

### 迁移问题

- 迁移错误不会完全相同，但以下是一个示例：

```none
14-2-4 18:56:49.5|Info|MigrationLogger|\*\*\* 36: update\_with\_quality\_converters migrating \*\*\*

14-2-4 18:56:49.6|Error|MigrationLogger|SQL logic error or missing database duplicate column name: Items

While Processing: "ALTER TABLE "QualityProfiles" ADD COLUMN "Items" TEXT"

```

### 权限问题

- 权限问题是由于应用程序无法访问相关临时文件夹和/或应用程序二进制文件夹而导致的。修复权限，以使应用程序运行的用户/组具有适当的访问权限（读写）。

- Synology 用户可能会遇到 Synology 的错误 `Access to the path '/proc/{some number}/maps is denied`

- Synology 用户还可能会在某些 NAS 上的 `/tmp` 中没有空间。您需要为应用程序指定其他 `/tmp` 路径。有关此问题的帮助，请参阅 SynoCommunity 或其他 Synology 支持渠道。

## 解决问题

在出现迁移问题时，您目前无法立即采取任何措施。如果问题是特定于您的情况（或尚无帖子），请在[我们的 subreddit](https://reddit.com/r/lidarr)上创建一个帖子，或者加入我们的 [discord](https://lidarr.audio/discord)。如果有其他人遇到相同的问题，那么请放心，我们正在努力解决。

> 请确保您没有尝试在稳定版本上使用来自 `nightly` 的数据库。不建议在不同分支之间跳转。
{.is-info}

### 权限问题

- 修复权限，以确保应用程序运行的用户/组可以访问（读写）`/tmp` 和应用程序的安装目录。

- 对于在 `/proc/###/maps` 上遇到问题的 Synology 用户，停止 Sonarr 或其他 \*Arr 应用程序并进行更新应该可以解决此问题。这是 SynoCommunity 包的问题。

### 手动升级

从我们的网站上获取最新版本。

安装更新（.exe）或解压缩（.zip）内容到现有安装上，并像往常一样重新运行 Lidarr。

# 下载和导入

下载和导入是大多数用户遇到问题的地方。从高层次的角度来看，Lidarr 需要能够与您的下载客户端进行通信，并访问它下载的文件。有各种各样的支持的下载客户端和各种各样的设置。这意味着虽然有一些常见的设置，但没有一个正确的设置，每个人的设置可能都有所不同。

> **第一步是将日志级别调整为 Trace，请参阅[日志和日志文件](#logging-and-log-files)以了解如何调整日志级别和搜索日志。然后，您将重现问题，并使用该时间段的跟踪级别日志来检查问题。**如果有人在帮助您，请将之前/之后的上下文放在[pastebin](https://0bin.net)、[Gist](https://gist.com)或类似的网站上以供他们查看。它不需要是整个文件，也不应该只是错误。您还应该在不运行会在日志文件中产生大量日志的任务时重现问题。
{.is-danger}

当您寻求帮助时，请确保阅读[寻求帮助](#asking-for-help)以便为我们提供所需的详细信息。

## 测试下载客户端

确保您的下载客户端正在运行。首先测试下载客户端，如果它无法工作，您将能够在跟踪级别日志中看到详细信息。您应该找到一个可以在浏览器中输入的 URL，并查看它是否有效。可能是连接问题，这可能表示 IP、主机名、端口错误，甚至是防火墙阻止访问。可能是明显的问题，比如身份验证问题，您可能输入了错误的用户名、密码或 API 密钥。

## 测试下载

现在我们来尝试下载，选择一首歌曲并进行手动搜索。选择其中一个文件并尝试下载它。它是否被发送到下载客户端？它是否以正确的类别结束？它是否显示在活动中？它是否在“检查已完成的下载”任务（刷新监视的下载和处理监视的下载任务）期间出现在跟踪级别日志中，该任务大约每分钟运行一次？它是否在该任务期间被正确解析？排队的下载是否有一个合理的名称？由于某些索引器/跟踪器是根据 ID 进行搜索的，它可能会使用无法识别的名称将其排队。

## 测试导入

导入问题几乎总是表现为活动中的一个带有橙色图标的项目，您可以将鼠标悬停在上面以查看错误。如果它们没有显示在活动中，则需要首先解决此问题，因此返回并找出原因。大多数导入错误都是*权限*问题，请记住，需要能够在下载文件夹中读取和写入。有时，库文件夹中的权限也可能有问题，因此请确保检查两者。

路径错误也是可能的，尽管在正常设置中较少见。理解路径问题的关键是知道从下载客户端通过其 API 获取下载的路径。这在更独特的用例中会成为一个问题，比如下载客户端在不同的系统上运行（甚至可能是不同的操作系统）。在 Docker 设置中，如果卷设置不正确，也可能发生这种情况。如果您没有控制权，比如种子盒设置，远程路径映射是一个很好的解决方案。在 Docker 设置中，修复路径是更好的选择。

## 常见问题

以下是一些常见问题。

### 下载客户端的 WebUI 未启用

Lidarr 通过下载客户端的 API 与您进行通信，并通过客户端的 WebUI 访问它。您必须确保客户端的 WebUI 已启用，并且它使用的端口不与其他正在使用的客户端端口或系统上的端口冲突。

### 使用了错误配置的 SSL

如果您同时在本地网络上使用实例和下载客户端，请确保未启用 SSL 加密。有关更多信息，请参阅[SSL 常见问题解答](/lidarr/faq#invalid-certificate-and-other-HTTPS-or-SSL-issues)。

### 在 Windows 上无法看到共享

Windows 服务的默认用户是 `LocalService`，通常没有访问您的共享的权限。编辑服务并将其设置为以您自己的用户身份运行，有关详细信息，请参阅常见问题解答中的条目[为什么无法在远程服务器上看到我的文件](/lidarr/faq#why-cant-see-my-files-on-a-remote-server)。

### 映射的网络驱动器不可靠

虽然像 `X:\` 这样的映射的网络驱动器很方便，但它们不像 `\\server\share` 这样的 UNC 路径可靠，而且在登录之前也无法使用。设置您的下载客户端，使其根据需要使用 UNC 路径。如果您的库位于共享中，您需要确保您的根文件夹使用 UNC 路径。如果您的下载客户端发送到共享，那么您将需要配置 UNC 路径，因为从下载客户端获取下载路径。您可以将映射的网络驱动器保留供您自己使用，只是不要将其用于自动化。

### Docker 和用户、组、所有权、权限和路径

Docker 增加了另一层容易出错但仍然可以正常运行但存在各种问题的复杂性。不要在这里详细介绍它们，请阅读这篇维基文章[用于这些自动化软件和 Docker 的指南](/docker-guide)，它涵盖了用户、组、所有权、权限和路径。它不特定于任何 Docker 系统，而是以高层次的方式介绍这些内容，以便您可以在自己的环境中实施它们。

### 远程路径映射

如果您在 Docker 中使用 Lidarr，而下载客户端在非 Docker 中（或反之亦然），或者将程序安装在不同的服务器上，则可能需要远程路径映射。

日志将如下所示

```none
2022-02-03 14:03:54.3|Error|DownloadedTracksImportService|Import failed, path does not exist or is not accessible by Lidarr: /volume3/data/torrents/music/Five Finger Death Punch - F8 (2020) FLAC. Ensure the path exists and the user running Lidarr has the correct permissions to access this file/folder
```

因此 `/volume3/data` 在 Lidarr 的容器中不存在或无法访问。

- [设置 => 下载客户端 => 远程路径映射](/lidarr/settings#remote-path-mappings)
- 当您的下载客户端报告已完成的数据的路径位于另一台服务器上，或者以 \*Arr 不处理该文件夹的方式时，将使用远程路径映射。
- 通常，只有在您的下载客户端在 Linux 上，而 \*Arr 在 Windows 上（或反之亦然），或者在混合 Docker 和本机客户端的情况下，才需要远程路径映射。如果使用远程服务器，则可能还需要远程路径映射。
- 远程路径映射是一个简单的搜索/替换（它会查找 REMOTE 值，并将其替换为指定主机的 LOCAL 值）。
- 如果关于错误路径的错误消息不包含 REPLACED 值，则路径映射未按您的预期工作。解决方法通常是添加和删除映射。
- [有关远程路径映射的更多信息，请参阅 TRaSH 的教程](https://trash-guides.info/Radarr/Radarr-remote-path-mapping/)

> 如果 \*Arr 和您的下载客户端都是 Docker 容器，很少需要远程路径映射。建议您[查看 Docker 指南](/docker-guide)和/或[按照 TRaSH 的教程操作](https://trash-guides.info/hardlinks)
{.is-info}

#### 远程挂载或远程同步（Syncthing）

- 您需要在下载的同时进行同步。您需要将本地同步目标设置为在 \*Arr 导入时可以进行硬链接的位置，这意味着它们位于同一文件系统并且看起来相同。
  - 在包含不完整和完整内容的较低、常见的文件夹中进行同步。
  - 将同步到与您的库相同的本地文件系统上的位置，并且看起来相同（Docker 和网络共享易于配置错误）。
  - 您希望同步不完整和完整的内容，以便当种子客户端执行移动操作时，本地反映该操作，并且所有文件已经“存在”（即使它们仍在下载）。然后，您希望使用硬链接，因为即使在导入之前它们还没有完成，它们仍然会完成。
  - 这样，在下载的整个过程中，它都在同步，然后种子客户端将其移动到电视子文件夹并同步反映该操作。这样，当下载被宣布为已完成时，下载基本上已经完成。即使它们还没有完全完成，有了硬链接的可能性，这也是可以的。
  - （可选 - 如果适用和/或需要（例如远程 Usenet 客户端））配置一个自定义脚本，在导入/下载/升级时删除远程文件。
- 相比之下，远程挂载而不是远程同步设置要简单得多，但通常速度较慢。
  - 使用 sshfs 或其他网络文件系统协议挂载远程存储。
  - 确保 \*Arr 配置为以读取或写入访问权限运行的用户和组。
  - 配置远程路径映射，以查找 REMOTE 路径并替换为 LOCAL 等效路径。

### 库文件夹的权限

日志将如下所示

```none
2022-02-28 18:51:01.1|Error|DownloadedTracksImportService|Import failed, path does not exist or is not accessible by Lidarr: /data/media/music/Jasmine Guillory/Party of Two - Jasmine Guillory.mp3. Ensure the path exists and the user running Lidarr has the correct permissions to access this file/folder
```

不要忘记检查*目标*的权限和所有权。很容易专注于下载的所有权和权限，通常这是与权限相关的问题的原因，但它*也可能*是目标的问题。检查目标文件夹是否存在。检查目标*文件*是否已经存在，或者无法删除或移动到回收站。检查所有权和权限是否允许复制、硬链接或移动下载的文件。运行的用户或组需要能够读取和写入根文件夹。

- 对于 Windows 用户，可能是由于运行为服务：
  - Windows 服务默认在“Local Service”帐户下运行，默认情况下，此帐户没有权限访问您的用户主目录，除非手动分配了权限。当使用配置为下载到您的主目录的下载客户端时，这一点特别重要。
  - “Local Service”通常具有非常有限的权限。因此，如果用户可以保持登录状态，建议将应用程序安装为系统托盘应用程序。安装程序提供了这样的选项。有关如何从服务转换为托盘应用程序的详细信息，请参阅常见问题解答。

- 对于 Synology 用户，请参阅[SynoCommunity 的软件包权限文章](https://github.com/SynoCommunity/spksrc/wiki/Permission-Management)

- 非 Windows：如果您使用的是 NFS 挂载，请确保启用了 `nolock`。
- 如果您使用的是 SMB 挂载，请确保启用了 `nobrl`。

### 下载文件夹的权限

日志将如下所示

```none
2022-02-28 18:51:01.1|Error|DownloadedTracksImportService|Import failed, path does not exist or is not accessible by Lidarr: /data/downloads/music/Party of Two - Jasmine Guillory.mp3. Ensure the path exists and the user running Lidarr has the correct permissions to access this file/folder
```

不要忘记检查*源*的权限和所有权。很容易专注于目标的所有权和权限，这是与权限相关的问题的*可能*原因，但通常是源的问题。检查源文件夹是否存在。检查所有权和权限是否允许复制/硬链接或复制+删除/移动下载的文件。运行的用户或组需要能够读取和写入下载文件夹。

- 对于 Windows 用户，可能是由于运行为服务：
  - Windows 服务默认在“Local Service”帐户下运行，默认情况下，此帐户没有权限访问您的用户主目录，除非手动分配了权限。当使用配置为下载到您的主目录的下载客户端时，这一点特别重要。
  - “Local Service”通常具有非常有限的权限。因此，如果用户可以保持登录状态，建议将应用程序安装为系统托盘应用程序。安装程序提供了这样的选项。有关如何从服务转换为托盘应用程序的详细信息，请参阅常见问题解答。

- 对于 Synology 用户，请参阅[SynoCommunity 的软件包权限文章](https://github.com/SynoCommunity/spksrc/wiki/Permission-Management)

- 非 Windows：如果您使用的是 NFS 挂载，请确保启用了 `nolock`。
- 如果您使用的是 SMB 挂载，请确保启用了 `nobrl`。

### 下载文件夹和库文件夹不是不同的文件夹

下载客户端应该下载到一个可被 \*Arr 访问的文件夹，并且不是您的根/库文件夹；应该从该单独的下载文件夹导入到您的库文件夹中。
您不应该直接下载到根文件夹。您也不应该将根文件夹用作下载客户端的已完成文件夹或未完成文件夹。
[**这也会导致系统中的健康检查问题**](/lidarr/system#downloading-into-root-folder)
在应用程序中，根文件夹被定义为配置的媒体库文件夹。这不是挂载的根文件夹。您的下载客户端将不完整或已完成的下载（或正在移动已完成的下载）到您的根（库）文件夹中。这经常会导致问题，并且不被建议。要解决此问题，请更改下载客户端，使其不会将下载放在根文件夹中。请注意，“放置”还包括如果您的下载客户端类别设置为根文件夹，或者如果 NZBGet/SABnzbd 启用了排序并且正在对根文件夹进行排序。请注意，此检查会查看所有已定义/配置的根文件夹，而不仅仅是当前正在使用的根文件夹。换句话说，您的下载客户端下载到的文件夹或将已完成的下载移动到的文件夹不应该是您在 \*Arr 应用程序中配置为根/库/最终媒体目标文件夹的相同文件夹。
配置的根文件夹（也称为库文件夹）可以在[设置 => 媒体管理 => 根文件夹](/lidarr/settings/#root-folders)中找到。
一个例子是，如果您的下载存储在 `\data\downloads` 中，那么您已经设置了一个根文件夹为 `\data\downloads`。

> 您的下载文件夹和根/库文件夹必须是不同的
{.is-warning}

### 类别设置错误

Lidarr 应该设置为使用类别，以便它只尝试处理自己的下载。很少有情况下，会添加没有正确类别的媒体。如果您手动添加种子并希望处理它们，它们需要具有正确的类别。可以随时设置它，因为每分钟都会尝试处理下载。

### 打包的种子

日志将显示类似以下的错误

```none
No files found are eligible for import
```

如果您的种子被打包在 `.rar` 文件中，您将需要设置解压缩。我们推荐使用 [Unpackerr](https://github.com/unpackerr/unpackerr)，因为它可以正确地进行解压缩：防止损坏的部分导入和在导入后清理解压缩的文件。

如果文件夹中没有有效的媒体文件，也会出现该错误。

### 重复下载

重复下载有几个原因，但其中一个与发布配置文件中的索引器限制有关。因为索引器*不会*存储在数据中，所以任何首选词得分对于库中的媒体来说都是*零*，但在“RSS”和搜索期间，它们将被应用。这会导致您一遍又一遍地下载项目，因为它看起来像一个升级，然后不是，然后再次出现并看起来像一个升级，然后不是。不要将发布配置文件限制为一个索引器。

这也可能是由于下载从未实际导入，然后从队列中消失，因此新的下载会不断被抓取并且永远不会导入。请参阅其他常见问题和故障排除步骤以解决此问题。

### Usenet 下载未导入

Lidarr 只查看 SABnzbd 和 NZBGet 中最近的 60 个下载，因此如果您保留您的历史记录，这意味着在具有导入问题的大型队列中，下载可能会被静默地错过并且不会导入。避免这种情况的最佳方法是保持您的历史记录清晰，以便任何仍然出现的项目都需要进行调查。您可以通过在“已完成和失败的下载处理程序”下启用“删除”来实现这一点。在 NZBGet 中，这将将项目移动到*隐藏*历史记录中，这非常好。不幸的是，SABnzbd 没有类似的功能。在那里，您最好能做的就是使用 nzb 备份文件夹。

### 下载客户端清除项目

下载客户端不应该负责删除下载内容。Usenet客户端应该配置为在历史记录中不删除下载内容。Torrent客户端应该配置为在完成做种后不删除种子（而是暂停或停止）。这是因为应用程序通过与下载客户端通信来确定要导入的内容，如果这些内容被删除了，就没有东西可以导入了...即使有一个文件夹里面装满了文件。

对于SABnzbd，可以通过“历史保留”设置来处理这个问题。

### 无法将下载内容与库项匹配

由于各种原因，下载后无法解析发布内容并发送到下载客户端。在“活动”=>“选项”=>“显示未知”（在最近的版本中默认启用）中，将显示所有未被忽略/已导入的Arr下载客户端类别中的项目。这些项目通常需要手动映射和导入。

如果您在下载客户端中有一个发布内容，但是该媒体项（电影/剧集/书籍/歌曲）在应用程序中不存在，也会出现此问题。

### 底层连接被关闭：发送时发生了意外错误

这是由索引器使用的SSL协议不受当前.NET版本支持所致，可以在[Radarr => 系统 => 状态](/radarr/system#status)中找到。

### 请求超时

Lidarr无法从客户端获取响应。

```none
    System.NET.WebException: 请求超时：’https://example.org/api?t=caps&apikey=(已删除) —> System.NET.WebException: 请求超时
```

```none
2022-11-01 10:16:54.3|警告|Newznab|无法连接到索引器

[v4.3.0.6671] System.Threading.Tasks.TaskCanceledException: 任务已取消。
```

这也可能是由以下原因引起的：

- VPN配置不正确或使用不当
- 代理配置不正确或使用不当
- 本地DNS问题-尝试更换不同的DNS提供商
- 本地IPv6问题-通常启用了IPv6，但无法正常工作
- 使用Privoxy并且配置不正确

## 未列出的问题

您还可以查看一些常见的权限和网络故障排除命令，详情请参阅我们的指南。否则，请在Discord上与支持团队讨论。如果这是一个常见问题，请建议将其添加到Wiki中。

# 搜索索引器和跟踪器

- 如果您使用[Prowlarr](/prowlarr)，那么您可以查看Prowlarr接收到的所有查询的[历史记录](/prowlarr/history)，以及它们是如何发送到站点的。确保在Prowlarr的历史记录=>选项中启用了“参数”。(i)图标提供了额外的详细信息。

## 将日志级别调整为跟踪

> **第一步是将日志级别调整为跟踪，请参阅[日志和日志文件](#logging-and-log-files)以了解如何调整日志级别和搜索日志。然后，您将重现问题，并使用该时间段的跟踪级别日志来检查问题。**如果有人在帮助您，请将上下文从之前/之后放在[pastebin](https://0bin.net)、[Gist](https://gist.com)或类似的网站上以供他们查看。它不需要整个文件，也不应该仅仅是错误。您还应该在不运行会生成大量日志文件的任务的情况下重现问题。
{.is-danger}

## 测试索引器或跟踪器

在测试索引器或跟踪器时，在调试或跟踪日志中可以找到使用的URL。下面是一个成功测试的示例，您可以看到它通过特定的URL和特定的参数查询索引器，然后返回响应。您可以在浏览器中测试此URL，将`apikey=(已删除)`替换为该索引器的正确apikey，例如`apikey=123`。它是否有效？是否看到了预期的结果？是否适用于此FAQ条目？在该URL中，您可以看到它使用`cat=5030,5040,5045,5080`设置了特定的类别，因此如果您没有看到预期的结果，这可能是一个可能的原因。您还可以看到它使用`tvdbid=354629`按tvdbid进行搜索，因此如果索引器上的剧集没有正确分类，就需要进行修复。您还可以看到它使用特定的季度和剧集进行搜索，例如season=1和ep=1，因此如果索引器上的信息不正确，您将无法看到这些结果。查看下面的手动搜索XML输出示例，以查看工作查询的输出。

- 手动搜索XML输出

```xml
需要索引器搜索响应示例
```

***需要图片***

![searches-indexers-and-trackers1.png](/assets/lidarr/searches-indexers-and-trackers1.png)
![searches-indexers-and-trackers2.png](/assets/lidarr/searches-indexers-and-trackers2.png)

- 跟踪日志片段

```none
需要手动搜索的跟踪日志片段
```

- 搜索的完整跟踪日志

```none
需要手动搜索的完整跟踪日志部分
```

## 常见问题

以下是一些常见问题。

### 媒体未监视

歌曲未被监视。

### 跟踪器需要RawSearch Caps

- Lidarr正在搜索“Kikis Delivery Service”，但您的跟踪器只有“Kiki's Delivery Service”的结果
- 这是由于您的跟踪器不支持正常的标准化搜索。
- 解决方案是更新跟踪器定义的搜索功能，指示它需要和支持“RawSearch”
- Jackett支持此标志，但需要在每个索引器上更新功能。为Jackett添加此功能，请提出一个功能请求。
- Prowlarr支持此标志，但需要在每个索引器上更新功能。为Prowlarr添加此功能，请提出一个功能请求。

### 类别错误

类别不正确可能是导致在索引器/跟踪器的手动搜索中显示结果，但在中没有显示结果的最常见原因，索引器/跟踪器应该在搜索结果中显示类别，这应该有助于您找出缺失的内容。如果您使用Jackett或Prowlarr，每个跟踪器都有一个特定支持的类别列表。确保在编辑条目时将列表显示在一个浏览器窗口中。

### 错误的结果

有时索引器会返回完全不相关的结果，可能会将参数传递给限制搜索范围，但返回的结果完全不相关。或者有时候，大部分相关但有一些错误的结果。第一种情况通常是索引器的问题，您可以从跟踪日志中看出是哪个索引器导致的。您可以禁用该索引器并报告问题。另一种情况通常是分类错误的发布内容，这应该可以在索引器/跟踪器上报告。

### 查询成功-未返回结果

您收到类似于“查询成功，但索引器未返回任何结果。这可能是索引器或索引器类别设置的问题。”的消息。

这是由于您的索引器未返回与您为索引器配置的类别相符的任何结果。

### 缺失的结果

如果您在网站上找到的结果在Lidarr中没有显示，那么您的问题可能是以下几种可能性之一：

- [类别不正确-请参见上文](#wrong-categories)
- 正在进行基于ID的搜索，而索引器没有将发布内容正确映射到该ID。这是只有您的索引器可以解决的问题。他们需要确保将发布内容映射到正确的适用ID。
- 没有按照Lidarr的搜索方式进行搜索；很可能您在索引器上搜索的术语不是Lidarr的查询方式。您可以从跟踪日志中看到Lidarr的查询方式。文本查询通常是以`q=words%20and%20things%20here`的格式，该字符串是经过HTTP编码的，可以使用任何在线的HTML解码/编码工具进行解码。

### 证书验证

您将通过https连接到大多数索引器/跟踪器，因此您的系统需要正确工作。这意味着您的时区和时间都需要设置正确。还意味着您的系统证书需要是最新的。

### 达到速率限制

如果您通过VPN或代理运行，您可能与数十个、数百个或数千个其他人竞争使用和/或您的索引器和跟踪器。速率限制和DDOS保护通常是通过IP地址完成的，而您的VPN/代理出口点是一个IP地址。除非您在像中国、澳大利亚或南非这样的专制国家，否则您不需要使用VPN/代理。

Rarbg倾向于在其API中具有某种速率限制，并显示为没有结果。

### IP封禁

与速率限制类似，某些索引器（如Nyaa）可能会直接封禁IP地址。这通常是半永久性的，解决方案是从您的ISP或VPN提供商获取新的IP。

### 使用Jackett的/all端点

Jackett的`/all`端点很方便，但除此之外都有潜在问题，因此需要单独添加每个跟踪器。或者，您可以尝试使用Jackett和NZBHydra2的替代方案[Prowlarr](/prowlarr)。

[Jackett甚至表示应避免使用/all，并且不应该使用。](https://github.com/Jackett/Jackett#aggregate-indexers)

使用all端点没有任何优势（除了减少管理开销），只有劣势：

- 您失去了对索引器特定设置（类别、搜索模式等）的控制
- 混合搜索模式（IMDB、查询等）可能会导致低质量的结果
- 无法使用索引器特定的类别（\>= 100000）。
- 慢速索引器将降低整体结果的速度
- 总结果限制为1000

添加每个索引器单独允许对每个索引器的类别进行精细调整，这在使用/all端点时可能会出现问题，如果使用错误的类别在某些跟踪器上引发错误。在中，如果支持分页，则每个索引器的结果限制为1000，如果不支持分页，则限制为100，这意味着随着您向Jackett添加越来越多的跟踪器，您越来越有可能剪裁结果。最后，如果/all中的一个跟踪器返回错误，将禁用，现在您将不会获得任何结果。

### 将NZBHydra2用作单个条目

将NZBHydra2作为单个索引器条目使用（即在NZBHydra2中为多个索引器添加一个NZBHydra2条目），而不是多个条目（即在NZBHydra2中为多个索引器添加多个NZBHydra2条目）具有与Jackett的/all端点相同的问题。

### 未列出的问题

您还可以查看一些常见的权限和网络故障排除命令，详情请参阅我们的指南。否则，请在Discord上与支持团队讨论。如果这是一个常见问题，请建议将其添加到Wiki中。

## 错误

以下是您在添加索引器时可能遇到的一些常见错误。

### 底层连接被关闭：发送时发生了意外错误

这是由于索引器使用的SSL协议不受当前.NET版本支持所致，可以在[Lidarr => 系统 => 状态](/lidarr/system#status)中找到。

### 请求超时

Lidarr无法从索引器获取响应。

```none
    System.NET.WebException: 请求超时：’https://example.org/api?t=caps&apikey=(已删除) —> System.NET.WebException: 请求超时
```

```none
2022-11-01 10:16:54.3|警告|Newznab|无法连接到索引器

[v4.3.0.6671] System.Threading.Tasks.TaskCanceledException: 任务已取消。
```

这也可能是由以下原因引起的：

- VPN配置不正确或使用不当
- 代理配置不正确或使用不当
- 本地DNS问题-尝试更换不同的DNS提供商
- 本地IPv6问题-通常启用了IPv6，但无法正常工作
- 使用Privoxy并且配置不正确

### 未列出的问题

您还可以查看一些常见的权限和网络故障排除命令，详情请参阅我们的指南。否则，请在Discord上与支持团队讨论。如果这是一个常见问题，请建议将其添加到Wiki中。